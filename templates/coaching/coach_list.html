{% extends "layouts/dashboard_base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Pro Coaching - EYTGaming{% endblock %}

{% block content %}
<!-- Include Skeleton Loaders -->
{% include "dashboard/components/skeleton_loaders.html" %}

<div class="max-w-7xl content-loaded">
    <!-- Gaming Header -->
    <div class="mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h1 class="gaming-header text-3xl md:text-4xl text-electric-red mb-2">PRO COACHING</h1>
            <p class="gaming-body text-gray-400">Find expert coaches to level up your game</p>
        </div>
        {% if user.can_coach %}
        <a href="{% url 'coaching:become_coach' %}" class="btn-gaming-primary">
            <span class="material-symbols-outlined mr-2">add</span>
            <span class="btn-gaming-text">BECOME A COACH</span>
        </a>
        {% endif %}
    </div>

    <!-- Gaming Filters -->
    {% include "coaching/components/filters_gaming.html" %}

    <!-- Gaming Coach List -->
    {% if coaches %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for coach in coaches %}
            {% include "coaching/components/coach_card_gaming.html" with coach=coach %}
        {% endfor %}
    </div>

    <!-- Gaming Pagination -->
    {% if is_paginated %}
    <div class="mt-12 flex justify-center items-center gap-3">
        {% if page_obj.has_previous %}
        <a href="?page=1" class="btn-gaming-outline">
            <span class="btn-gaming-text">FIRST</span>
        </a>
        <a href="?page={{ page_obj.previous_page_number }}" class="btn-gaming-outline">
            <span class="btn-gaming-text">PREVIOUS</span>
        </a>
        {% endif %}
        
        <span class="px-6 py-3 bg-electric-red text-white gaming-subheader rounded border-2 border-electric-red">
            PAGE {{ page_obj.number }} OF {{ page_obj.paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="btn-gaming-outline">
            <span class="btn-gaming-text">NEXT</span>
        </a>
        <a href="?page={{ page_obj.paginator.num_pages }}" class="btn-gaming-outline">
            <span class="btn-gaming-text">LAST</span>
        </a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <!-- Gaming Empty State -->
    <div class="card-gaming text-center py-16">
        <div class="mb-8">
            <span class="material-symbols-outlined text-electric-red text-8xl neon-red-glow">sports_esports</span>
        </div>
        <h2 class="gaming-header text-2xl text-white mb-4">NO COACHES FOUND</h2>
        <p class="gaming-body text-gray-400 mb-8 max-w-md mx-auto">No coaches match your current filters. Try adjusting your search criteria or check back later!</p>
        {% if user.can_coach %}
        <a href="{% url 'coaching:become_coach' %}" class="btn-gaming-primary">
            <span class="btn-gaming-text">BECOME THE FIRST COACH</span>
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const filterForm = document.getElementById('filter-form');
    const searchInput = document.getElementById('search-input');
    
    // Auto-submit form on filter change
    ['game-filter', 'price-filter', 'experience-filter', 'sort-filter'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.addEventListener('change', function() {
                filterForm.submit();
            });
        }
    });
    
    // Debounced search
    let searchTimeout;
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                if (this.value.length >= 3 || this.value.length === 0) {
                    filterForm.submit();
                }
            }, 500);
        });
    }
});
</script>
{% endblock %}
