{% extends "layouts/dashboard_base.html" %}

{% block title %}Create Team - EYTGaming{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="mb-6 md:mb-8">
        <h1 class="text-white text-2xl md:text-3xl font-bold mb-2">Create Your Team</h1>
        <p class="text-gray-400 text-sm md:text-base">Build your competitive gaming team and start competing</p>
    </div>

    <!-- Form -->
    <form method="post" enctype="multipart/form-data" class="space-y-6" aria-label="Create team form">
        {% csrf_token %}
        
        <!-- Display form errors -->
        {% if form.non_field_errors %}
        <div class="bg-red-500/10 border border-red-500/50 rounded-lg p-4" role="alert" aria-live="assertive">
            <div class="flex items-start gap-3">
                <span class="material-symbols-outlined text-red-500" aria-hidden="true">error</span>
                <div class="flex-1">
                    <h3 class="text-red-500 font-medium mb-1">Form Errors</h3>
                    {% for error in form.non_field_errors %}
                    <p class="text-red-400 text-sm">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Basic Information -->
        <fieldset class="bg-card-dark border border-card-border-dark rounded-lg p-6">
            <legend class="text-white text-xl font-bold mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined" aria-hidden="true">info</span>
                Basic Information
            </legend>
            
            <div class="space-y-4">
                <!-- Team Name -->
                <div>
                    <label for="{{ form.name.id_for_label }}" class="block text-gray-300 font-medium mb-2">
                        {{ form.name.label }} <span class="text-red-500" aria-label="required">*</span>
                    </label>
                    {{ form.name }}
                    {% if form.name.help_text %}
                    <p class="text-gray-500 text-sm mt-1" id="{{ form.name.id_for_label }}-help">{{ form.name.help_text }}</p>
                    {% endif %}
                    {% if form.name.errors %}
                    <p class="text-red-400 text-sm mt-1" role="alert" id="{{ form.name.id_for_label }}-error">{{ form.name.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Team Tag -->
                <div>
                    <label for="{{ form.tag.id_for_label }}" class="block text-gray-300 font-medium mb-2">
                        {{ form.tag.label }} <span class="text-red-500">*</span>
                    </label>
                    {{ form.tag }}
                    {% if form.tag.help_text %}
                    <p class="text-gray-500 text-sm mt-1">{{ form.tag.help_text }}</p>
                    {% endif %}
                    {% if form.tag.errors %}
                    <p class="text-red-400 text-sm mt-1">{{ form.tag.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Game -->
                <div>
                    <label for="{{ form.game.id_for_label }}" class="block text-gray-300 font-medium mb-2">
                        {{ form.game.label }} <span class="text-red-500">*</span>
                    </label>
                    {{ form.game }}
                    {% if form.game.errors %}
                    <p class="text-red-400 text-sm mt-1">{{ form.game.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Description -->
                <div>
                    <label for="{{ form.description.id_for_label }}" class="block text-gray-300 font-medium mb-2">
                        {{ form.description.label }}
                    </label>
                    {{ form.description }}
                    {% if form.description.help_text %}
                    <p class="text-gray-500 text-sm mt-1">{{ form.description.help_text }}</p>
                    {% endif %}
                    {% if form.description.errors %}
                    <p class="text-red-400 text-sm mt-1" role="alert">{{ form.description.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>
        </fieldset>

        <!-- Team Images -->
        <fieldset class="bg-card-dark border border-card-border-dark rounded-lg p-6">
            <legend class="text-white text-xl font-bold mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined" aria-hidden="true">image</span>
                Team Images
            </legend>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Logo Upload -->
                <div>
                    <label for="{{ form.logo.id_for_label }}" class="block text-gray-300 font-medium mb-2">
                        {{ form.logo.label }}
                    </label>
                    <div class="relative">
                        <div id="logo-preview" 
                             class="w-full h-48 bg-background-dark border-2 border-dashed border-card-border-dark rounded-lg flex items-center justify-center cursor-pointer hover:border-primary transition-colors focus-within:ring-2 focus-within:ring-primary/50"
                             role="button"
                             tabindex="0"
                             aria-label="Upload team logo">
                            <div class="text-center">
                                <span class="material-symbols-outlined text-gray-500 text-5xl mb-2" aria-hidden="true">upload</span>
                                <p class="text-gray-400 text-sm">Click to upload logo</p>
                                <p class="text-gray-500 text-xs mt-1">Square image recommended</p>
                            </div>
                        </div>
                        {{ form.logo }}
                    </div>
                    {% if form.logo.help_text %}
                    <p class="text-gray-500 text-sm mt-1" id="{{ form.logo.id_for_label }}-help">{{ form.logo.help_text }}</p>
                    {% endif %}
                    {% if form.logo.errors %}
                    <p class="text-red-400 text-sm mt-1" role="alert" id="{{ form.logo.id_for_label }}-error">{{ form.logo.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Banner Upload -->
                <div>
                    <label class="block text-gray-300 font-medium mb-2">
                        {{ form.banner.label }}
                    </label>
                    <div class="relative">
                        <div id="banner-preview" class="w-full h-48 bg-background-dark border-2 border-dashed border-card-border-dark rounded-lg flex items-center justify-center cursor-pointer hover:border-primary transition-colors">
                            <div class="text-center">
                                <span class="material-symbols-outlined text-gray-500 text-5xl mb-2">upload</span>
                                <p class="text-gray-400 text-sm">Click to upload banner</p>
                                <p class="text-gray-500 text-xs mt-1">Wide image recommended</p>
                            </div>
                        </div>
                        {{ form.banner }}
                    </div>
                    {% if form.banner.help_text %}
                    <p class="text-gray-500 text-sm mt-1">{{ form.banner.help_text }}</p>
                    {% endif %}
                    {% if form.banner.errors %}
                    <p class="text-red-400 text-sm mt-1">{{ form.banner.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>
        </fieldset>

        <!-- Team Settings -->
        <fieldset class="bg-card-dark border border-card-border-dark rounded-lg p-6">
            <legend class="text-white text-xl font-bold mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined" aria-hidden="true">settings</span>
                Team Settings
            </legend>
            
            <div class="space-y-4">
                <!-- Max Members -->
                <div>
                    <label for="{{ form.max_members.id_for_label }}" class="block text-gray-300 font-medium mb-2">
                        {{ form.max_members.label }}
                    </label>
                    {{ form.max_members }}
                    {% if form.max_members.help_text %}
                    <p class="text-gray-500 text-sm mt-1">{{ form.max_members.help_text }}</p>
                    {% endif %}
                    {% if form.max_members.errors %}
                    <p class="text-red-400 text-sm mt-1">{{ form.max_members.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Checkboxes -->
                <div class="space-y-3" role="group" aria-label="Team visibility and recruitment settings">
                    <!-- Requires Approval -->
                    <div class="flex items-start gap-3">
                        {{ form.requires_approval }}
                        <div class="flex-1">
                            <label for="{{ form.requires_approval.id_for_label }}" class="text-gray-300 font-medium cursor-pointer">
                                {{ form.requires_approval.label }}
                            </label>
                            <p class="text-gray-500 text-sm" id="{{ form.requires_approval.id_for_label }}-help">Applications must be approved by captain or co-captain</p>
                        </div>
                    </div>

                    <!-- Is Recruiting -->
                    <div class="flex items-start gap-3">
                        {{ form.is_recruiting }}
                        <div class="flex-1">
                            <label for="{{ form.is_recruiting.id_for_label }}" class="text-gray-300 font-medium cursor-pointer">
                                {{ form.is_recruiting.label }}
                            </label>
                            <p class="text-gray-500 text-sm" id="{{ form.is_recruiting.id_for_label }}-help">Show recruiting badge and allow applications</p>
                        </div>
                    </div>

                    <!-- Is Public -->
                    <div class="flex items-start gap-3">
                        {{ form.is_public }}
                        <div class="flex-1">
                            <label for="{{ form.is_public.id_for_label }}" class="text-gray-300 font-medium cursor-pointer">
                                {{ form.is_public.label }}
                            </label>
                            <p class="text-gray-500 text-sm" id="{{ form.is_public.id_for_label }}-help">Team will be visible in public listings</p>
                        </div>
                    </div>
                </div>
            </div>
        </fieldset>

        <!-- Social Links -->
        <fieldset class="bg-card-dark border border-card-border-dark rounded-lg p-6">
            <legend class="text-white text-xl font-bold mb-4 flex items-center gap-2">
                <span class="material-symbols-outlined" aria-hidden="true">link</span>
                Social Links
            </legend>
            
            <div class="space-y-4">
                <!-- Discord -->
                <div>
                    <label for="{{ form.discord_server.id_for_label }}" class="block text-gray-300 font-medium mb-2 flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm" aria-hidden="true">forum</span>
                        {{ form.discord_server.label }}
                    </label>
                    {{ form.discord_server }}
                    {% if form.discord_server.errors %}
                    <p class="text-red-400 text-sm mt-1" role="alert">{{ form.discord_server.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Twitter -->
                <div>
                    <label for="{{ form.twitter_url.id_for_label }}" class="block text-gray-300 font-medium mb-2 flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm" aria-hidden="true">tag</span>
                        {{ form.twitter_url.label }}
                    </label>
                    {{ form.twitter_url }}
                    {% if form.twitter_url.errors %}
                    <p class="text-red-400 text-sm mt-1" role="alert">{{ form.twitter_url.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Twitch -->
                <div>
                    <label for="{{ form.twitch_url.id_for_label }}" class="block text-gray-300 font-medium mb-2 flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm" aria-hidden="true">videocam</span>
                        {{ form.twitch_url.label }}
                    </label>
                    {{ form.twitch_url }}
                    {% if form.twitch_url.errors %}
                    <p class="text-red-400 text-sm mt-1" role="alert">{{ form.twitch_url.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>
        </fieldset>

        <!-- Form Actions -->
        <div class="flex flex-col sm:flex-row items-center justify-end gap-3 md:gap-4">
            <a href="{% url 'teams:list' %}" 
               class="w-full sm:w-auto px-6 py-3 min-h-[48px] bg-gray-700 hover:bg-gray-600 text-white font-medium rounded-lg transition-colors flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2 focus:ring-offset-background-dark"
               aria-label="Cancel and return to teams list">
                Cancel
            </a>
            <button type="submit" 
                    class="w-full sm:w-auto px-6 py-3 min-h-[48px] bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2 focus:ring-offset-background-dark"
                    aria-label="Create team">
                <span class="material-symbols-outlined" aria-hidden="true">add</span>
                Create Team
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Logo upload preview
    const logoInput = document.getElementById('{{ form.logo.id_for_label }}');
    const logoPreview = document.getElementById('logo-preview');
    
    if (logoInput && logoPreview) {
        // Click handler
        logoPreview.addEventListener('click', function() {
            logoInput.click();
        });
        
        // Keyboard handler (Enter or Space)
        logoPreview.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                logoInput.click();
            }
        });
        
        // File change handler with screen reader announcement
        logoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoPreview.innerHTML = `<img src="${e.target.result}" alt="Logo preview" class="w-full h-full object-contain">`;
                    logoPreview.setAttribute('aria-label', 'Team logo uploaded: ' + file.name);
                    
                    // Announce to screen readers
                    const announcement = document.createElement('div');
                    announcement.setAttribute('role', 'status');
                    announcement.setAttribute('aria-live', 'polite');
                    announcement.className = 'sr-only';
                    announcement.textContent = 'Logo uploaded successfully';
                    document.body.appendChild(announcement);
                    setTimeout(() => announcement.remove(), 1000);
                };
                reader.readAsDataURL(file);
            }
        });
    }
    
    // Banner upload preview
    const bannerInput = document.getElementById('{{ form.banner.id_for_label }}');
    const bannerPreview = document.getElementById('banner-preview');
    
    if (bannerInput && bannerPreview) {
        // Click handler
        bannerPreview.addEventListener('click', function() {
            bannerInput.click();
        });
        
        // Keyboard handler (Enter or Space)
        bannerPreview.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                bannerInput.click();
            }
        });
        
        // File change handler with screen reader announcement
        bannerInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    bannerPreview.innerHTML = `<img src="${e.target.result}" alt="Banner preview" class="w-full h-full object-cover">`;
                    bannerPreview.setAttribute('aria-label', 'Team banner uploaded: ' + file.name);
                    
                    // Announce to screen readers
                    const announcement = document.createElement('div');
                    announcement.setAttribute('role', 'status');
                    announcement.setAttribute('aria-live', 'polite');
                    announcement.className = 'sr-only';
                    announcement.textContent = 'Banner uploaded successfully';
                    document.body.appendChild(announcement);
                    setTimeout(() => announcement.remove(), 1000);
                };
                reader.readAsDataURL(file);
            }
        });
    }
    
    // Auto-uppercase team tag
    const tagInput = document.getElementById('{{ form.tag.id_for_label }}');
    if (tagInput) {
        tagInput.addEventListener('input', function(e) {
            this.value = this.value.toUpperCase();
        });
    }
});
</script>
{% endblock %}
